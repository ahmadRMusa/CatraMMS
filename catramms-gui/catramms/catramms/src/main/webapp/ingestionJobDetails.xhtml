<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:media="http://xmlns.jcp.org/jsf/composite/media">

<f:metadata>
    <f:viewParam name="ingestionJobKey" value="#{ingestionJobDetails.ingestionJobKey}" />
    <f:viewAction action="#{ingestionJobDetails.init}" />
</f:metadata>

<h:head>

    <h:outputStylesheet library="css" name="catramms.css"  />

</h:head>

<h:body>

    <ui:include src="/common/loadingDialog.xhtml"/>

    <h:form id="viewForm">

        <p:toolbar>
            <p:toolbarGroup align="left">
                <p:outputLabel styleClass="appTitle" value="Media Management System" />
            </p:toolbarGroup>

            <p:toolbarGroup align="right">

                <p:outputLabel value="Welcome #{login.userName}" />

                <span class="ui-separator">
                    <span class="ui-icon ui-icon-grip-dotted-vertical" />
                </span>

                <p:outputLabel value="Workspace:" />
                <p:selectOneMenu id="workspaceName" value="#{ingestionJobDetails.workspaceName}"
                                 autoWidth="false">
                    <f:selectItems value="#{ingestionJobDetails.workspaceNames}" />
                    <p:ajax
                            global="true"
                            event="change"
                            listener="#{ingestionJobDetails.init}"
                            update="ingestionJobDetailsTabView" />
                </p:selectOneMenu>

                <span class="ui-separator">
                    <span class="ui-icon ui-icon-grip-dotted-vertical" />
                </span>

                <p:commandLink value="Logout" action="#{login.logout}" />

                <span class="ui-separator">
                    <span class="ui-icon ui-icon-grip-dotted-vertical" />
                </span>

                <ui:include src="/common/mainMenu.xhtml"/>

            </p:toolbarGroup>
        </p:toolbar>

        <p:toolbar>
            <p:toolbarGroup align="left">
                <span class="ui-separator">
                    <span class="ui-icon ui-icon-grip-dotted-vertical" />
                </span>

                <p:outputLabel styleClass="viewTitle" value="Ingestion Job Details" />
            </p:toolbarGroup>

            <p:toolbarGroup align="right">

                <p:outputLabel value="Ingestion Job Key: #{ingestionJobDetails.ingestionJobKey}" />

            </p:toolbarGroup>
        </p:toolbar>

        <p:tabView id="ingestionJobDetailsTabView" dynamic="false" cache="true">

            <p:tab title="Ingestion Info">

                <p:panelGrid rendered="#{ingestionJobDetails.ingestionJob != null}" columns="2" cellpadding="10">

                    <p:outputLabel value="Ingestion Job Key: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.ingestionJobKey}" />

                    <p:outputLabel value="Label: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.label}" />

                    <p:outputLabel value="Type: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.ingestionType}" />

                    <p:outputLabel value="Start Processing: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.startProcessing}">
                        <f:convertDateTime type="date" pattern="dd-MM-yyyy HH:mm:ss" timeZone="CET"/>
                    </p:outputLabel>

                    <p:outputLabel value="End Processing: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.endProcessing}">
                        <f:convertDateTime type="date" pattern="dd-MM-yyyy HH:mm:ss" timeZone="CET"/>
                    </p:outputLabel>

                    <p:outputLabel value="Status: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.status}" />

                    <p:outputLabel value="Error Message: " />
                    <p:outputLabel id="errorMessage" value="#{ingestionJobDetails.ingestionJob.errorMessage}"
                                   title="#{ingestionJobDetails.ingestionJob.errorMessage}" />
                    <p:tooltip for="errorMessage"
                               showEffect="clip" hideEffect="explode" position="left"/>

                    <p:outputLabel value="Downloading Progress: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.downloadingProgress}" />

                    <p:outputLabel value="Uploading Progress: " />
                    <p:outputLabel value="#{ingestionJobDetails.ingestionJob.uploadingProgress}" />

                </p:panelGrid>

            </p:tab>

            <p:tab title="Media Items generated by the Ingestion Job (#{ingestionJobDetails.ingestionJob.ingestionJobMediaItemList.size()})">

                <p:dataTable rendered="#{ingestionJobDetails.ingestionJob != null}"
                             resizableColumns="true" id="ingestionJobMediaItemDataTable" var="mediaItem" rowIndexVar="rowId"
                             value="#{ingestionJobDetails.ingestionJob.ingestionJobMediaItemList}"
                             rowKey="#{mediaItem.mediaItemKey}" >

                    <!--
                    <f:facet name="header">
                        <p:outputLabel style="font-weight: bold"
                                value="Media Items generated by the Ingestion Job" />
                    </f:facet>
                    -->
                    <p:column headerText="Media Item Key" >
                        <p:outputLabel value="#{mediaItem.mediaItemKey}" />
                    </p:column>

                    <p:column headerText="Physical Path Key" >
                        <p:outputLabel value="#{mediaItem.physicalPathKey}" />
                    </p:column>

                    <p:column style="width:90px;" headerText="" >
                        <h:link disabled="#{mediaItem.mediaItemKey == null}"
                                outcome="/mediaItemDetails.xhtml?faces-redirect=true" value="Details">
                            <f:param name="mediaItemKey" value="#{mediaItem.mediaItemKey}" />
                        </h:link>
                    </p:column>

                </p:dataTable>
            </p:tab>
        </p:tabView>

    </h:form>

</h:body>
</html>